@model ISDK.Filuet.Theme.FiluetHerbalife.Models.Checkout.CustomOnePageCheckoutModel
@{
    Layout = "_ColumnsOne";

    //scripts
    NopHtml.AddScriptParts(ResourceLocation.Footer, "~/js/public.onepagecheckout.js");
    NopHtml.AddScriptParts(ResourceLocation.Footer, "~/Themes/FiluetHerbalife/Content/js/processorder.js");
    var storeLocation = webHelper.GetStoreLocation();

    NopHtml.AddCssFileParts("~/lib_npm/jquery-ui-dist/jquery-ui.min.css");

    //title
    NopHtml.AddTitleParts(T("PageTitle.Checkout").Text);
    //page class
    NopHtml.AppendPageCssClassParts("html-checkout-page");
}
@{
    var email = (await workContext.GetCurrentCustomerAsync()).Email;
    var userName = string.Join(' ',
        (await workContext.GetCurrentCustomerAsync()).FirstName,
        (await workContext.GetCurrentCustomerAsync()).LastName);
}

@{
    var viewData = new ViewDataDictionary(ViewData)
{
        {"checkoutActiveClass", "active"}
    };
}
<style>
    input[type=checkbox] {
        display: none;
    }

        input[type=checkbox]:checked + label {
            color: #266431;
        }

        input[type=checkbox] + label {
            color: #646868;
            font-size: 15px;
            line-height: 18px;
            position: relative;
            display: table-cell;
            height: 20px;
            padding-left: 34px;
            cursor: pointer;
            transition: color .2s linear;
            text-align: left;
            vertical-align: middle;
        }

        input[type=checkbox]:checked + label:before {
            border-color: #266431;
        }

        input[type=checkbox] + label:before {
            position: absolute;
            top: 0;
            left: 0;
            display: block;
            width: 20px;
            height: 20px;
            content: '';
            transition: border-color .2s linear;
            border: 1px solid #cbcdcd;
            border-radius: 2px;
        }

        input[type=checkbox]:checked + label:after {
            opacity: 1;
        }

        input[type=checkbox] + label:after {
            position: absolute;
            top: 5px;
            left: 5px;
            display: block;
            width: 10px;
            height: 6px;
            content: '';
            transition: opacity .2s linear;
            transform: rotate(-45deg);
            opacity: 0;
            border-bottom: 1px solid #266431;
            border-left: 1px solid #266431;
        }

    .terms-of-service .read {
        color: blue;
        text-decoration: underline;
    }

    .ui-dialog-titlebar {
        border-color: inherit;
        color: #fff;
        background-color: #266431;
        padding: 12px 16px;
        position: relative;
        z-index: 100;
    }

    .ui-dialog-title {
        padding: 0.5em 0;
        margin: -0.5em 0;
        font-size: 16px;
        line-height: 1.25;
        text-overflow: ellipsis;
        overflow: hidden;
        cursor: default;
        -ms-flex: 1;
        flex: 1;
        display: -ms-flexbox;
        display: flex;
        -ms-flex-flow: row n;
    }

    .ui-dialog-titlebar .ui-button {
        position: absolute;
        right: 16px;
        top: 0;
        bottom: 0;
        margin: auto;
    }

    .ui-dialog .ui-dialog-content {
        background-color: #fff;
        position: relative;
        z-index: 100;
        padding: 12px 16px;
        overflow: auto;
    }

    .ui-dialog::after {
        content: '';
        display: block;
        position: fixed;
        width: 100%;
        height: 100%;
        background-color: black;
        opacity: 0.4;
        top: 0;
        left: 0;
        z-index: 99;
    }
</style>
@await Html.PartialAsync("_CheckoutSteps", viewData)


<section class="checkout_info block">
    <div class="cont">
        <div class="block_head">
            <div class="title">@T("ISDK.Filuet.Theme.FiluetHerbalife.Checkout.FillOrderDetails")</div>
        </div>

        <form asp-controller="FiluetHerbalifeCheckout" asp-action="OpcSaveShippingDelivery" method="post" id="co-shipping-method-and-payment-info-form" class="form">
            <script asp-location="Footer">
                var localized_data = {
                    SpecifyMethodError: "@T("Plugins.ShippingMethods.Delivery.FillIn")",
                };

                var phoneMask = "@(!string.IsNullOrEmpty(Model.PhoneMask) ? Model.PhoneMask : "")";

                HerbalifeOnePageCheckout.init('#co-shipping-method-and-payment-info-form',
                    '@(storeLocation)checkout/OpcSaveShippingMethod/',
                    localized_data, phoneMask);
            </script>

            <div class="col">
                <div class="line" style="display:none">
                    <div class="label">@T("isdk.filuet.theme.filuetherbalife.checkout.shippingcountry")</div>

                    <div class="field">
                        <select id="shipping-country-select" name="shippingcountry" placeholder="select..." style="display: none;">
                        </select>
                    </div>
                </div>

                <div class="line">
                    <div class="label">@T("ISDK.Filuet.Theme.FiluetHerbalife.Checkout.ShippingMethod")</div>

                    <div class="field">
                        <select id="delivery-type-select" name="deliveryType" placeholder="Select..." style="display: none;">
                        </select>
                    </div>
                </div>

                <div class="line">
                    <div id="delivery-city-label" class="label">@T("Order.Shipping.City")</div>

                    <div class="field">
                        <select id="delivery-city-select" name="deliveryCity" placeholder="Select..." style="display: none;">
                        </select>
                    </div>
                </div>

                <div id="delivery-operator-cont" class="line">
                    <div id="delivery-operator-label" class="label">@T("Plugins.ShippingMethods.Delivery.DeliveryOperator")</div>

                    <div class="field">
                        <select id="delivery-operator-select" name="deliveryOperator" placeholder="Select..." style="display: none;">
                        </select>
                    </div>
                </div>

                <div id="pick-address-cont" class="line">
                    <div id="selfpickup-address-label" class="label">@T("Plugins.ShippingMethods.Delivery.PickupCenterAddress")</div>
                    <div id="pickpoint-address-label" class="label">@T("Plugins.ShippingMethods.Delivery.PickupPointAddress")</div>

                    <div class="field">
                        <select id="pick-address-select" name="deliveryAddress" placeholder="Select..." style="display: none;">
                        </select>
                    </div>
                </div>

                <div id="delivery-address-cont" class="line">
                    <div id="delivery-address-label" class="label">@T("Plugins.ShippingMethods.Delivery.Fields.Address")</div>

                    <div class="field">
                        <input id="delivery-address-input" type="text" name="deliveryAddress" value="" class="input" placeholder="" />
                    </div>
                </div>

                <div id="delivery-postcode-cont" class="line">
                    <div id="delivery-postcode-label" class="label">@T("Plugins.ShippingMethods.Delivery.PostCode")</div>

                    <div class="field">
                        <input id="delivery-postcode-input" type="text" name="receiverPostCode" value="" class="input" placeholder="" />
                    </div>
                </div>

                <div class="line">
                    <div class="label">@T("ShoppingCart.Totals.DeliveryPrice")</div>

                    <div id="delivery-price-div" class="field delivery_price" name="">€ 0.00</div>
                    <input id="delivery-priceId-input" type="number" name="operatorPriceId" style="display: none;" />
                </div>
            </div>

            <div class="col">
                <div class="line">
                    <div id="receiver-name-label" class="label">@T("ISDK.Filuet.Theme.FiluetHerbalife.Checkout.ReceiverName")</div>

                    <div class="field">
                        <input id="receiver-name-input" type="text" name="receiverName" value="@userName" class="input" placeholder="" />
                    </div>
                </div>

                <div class="line">
                    <div id="receiver-phone-label" class="label">@T("Order.Phone")</div>
                    <div id="receiver-phone-format-label" class="label">@Html.Raw(T("Plugins.ShippingMethods.Delivery.EnterPhoneFormat").Text.EscapeJavaScriptString())</div>

                    <div class="field">
                        <span style="text-align: center; position: relative; float: left; top: 10px;">@Model.PhonePrefix</span>
                        <input id="receiver-phone-input" name="receiverPhone" list="phones" value="" class="input" style="width: calc(100% - 50px); margin-left: 50px;" inputmode="verbatim" />
                        <datalist id="phones">
                            @foreach (var phone in Model.Phones)
                            {
                                <option value="@phone" />
                            }
                        </datalist>
                    </div>
                </div>

                <div class="line">
                    <div id="receiver-email-label" class="label">@T("Order.Email")</div>

                    <div class="field">
                        <input id="receiver-email-input" type="email" name="receiverEmail" value="@email" class="input" placeholder="" />
                    </div>
                </div>

                @await Component.InvokeAsync("PaymentPayeezy")
            </div>

            <div class="col">
                <div class="line">
                    <div class="label">@T("ISDK.Filuet.Theme.FiluetHerbalife.Shipping.DeliveryComment") <b>(50)</b></div>

                    <div class="field">
                        <textarea name="comment" maxlength="50"></textarea>
                    </div>
                </div>
                @if (Model.PaymentMethods.Count > 0)
                {
                    @for (var i = 0; i < Model.PaymentMethods.Count; i++)
                    {
                        var paymentMethod = Model.PaymentMethods[i];
                        var paymentMethodName = paymentMethod.Name;
                        if (!string.IsNullOrEmpty(paymentMethod.Fee))
                        {
                            paymentMethodName = T("Checkout.SelectPaymentMethod.MethodAndFee", paymentMethodName, paymentMethod.Fee).Text;
                        }
                        <div class="line">
                            <div class="method-name">
                                @if (!string.IsNullOrEmpty(paymentMethod.LogoUrl))
                                {
                                    <div class="payment-logo">
                                        <label for="paymentmethod_@(i)">
                                            <img src="@paymentMethod.LogoUrl" alt="@paymentMethodName" height="64" />
                                        </label>
                                    </div>
                                }
                                <div class="payment-details">
                                    <input id="paymentmethod_@(i)" type="radio" name="paymentmethod" value="@(paymentMethod.PaymentMethodSystemName)" checked="@paymentMethod.Selected" />
                                    <label for="paymentmethod_@(i)">@paymentMethodName</label>
                                    @if (!string.IsNullOrEmpty(paymentMethod.Description))
                                    {
                                        <div class="payment-description">@paymentMethod.Description</div>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
        </form>
        <div id="terms-of-service-warning-box" title="@T("Checkout.TermsOfService")" style="display: none;">
            <p>@T("Checkout.TermsOfService.PleaseAccept")</p>
        </div>
        <div class="terms-of-service">
            <input id="termsofservice" type="checkbox" name="termsofservice" />
            <label for="termsofservice">@T("Checkout.TermsOfService.IAccept")</label>
            <script asp-location="Footer">
                $(document).ready(function () {
                    $('#read-terms').on('click',
                        function (e) {
                            e.preventDefault();
                            displayPopupContentFromUrl(
                                '@Url.RouteUrl("TopicPopup", new { SystemName = "Conditions of Use" })',
                                '@T("Checkout.TermsOfService")');
                        });
                });
            </script>
        </div>

        <script asp-location="Footer">
            $(document).ready(function () {
                $('#checkoutBtnId').on('click', function () {

                    //terms of service
                    var termOfServiceOk = true;
                    if ($('#termsofservice').length > 0) {
                        //terms of service element exists
                        if (!$('#termsofservice').is(':checked')) {
                            $("#terms-of-service-warning-box").dialog();
                            termOfServiceOk = false;
                        } else {
                            termOfServiceOk = true;
                            HerbalifeOnePageCheckout.save()
                        }
                    }
                    return termOfServiceOk;
                });
            });
        </script>
        <div class="btns">
            <a href="@Url.RouteUrl("ShoppingCart")" class="btn back_btn">@T("Common.Back")</a>
            <button id="checkoutBtnId" class="btn next_btn">@T("Common.Continue")</button>
        </div>
    </div>
</section>

<section class="modal" id="unable_deliver_modal">
    <div class="modal_title">@T("ISDK.Filuet.Theme.FiluetHerbalife.Checkout.UnableToDeliver")</div>

    <div id="unable_deliver_modal_hidden_desc" style="display: none;">@T("Cart.Dialogiscartvalid")</div>
    <div id="unable_deliver_modal_desc" class="modal_desc"></div>

    <div class="btns">
        <a href="@Url.RouteUrl("ShoppingCart")" class="btn green edit_order_btn">@T("ISDK.Filuet.Theme.FiluetHerbalife.Checkout.EditOrder")</a>

        <a href="" id="change_country_btn" class="btn change_month_btn">@T("ISDK.Filuet.Theme.FiluetHerbalife.Checkout.ChangeCountry")</a>
    </div>
</section>